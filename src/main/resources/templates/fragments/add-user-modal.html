<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:fragment="addUserModal">
  <div
    id="add-user-modal"
    class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 justify-center items-center z-50"
  >
    <div class="bg-white p-6 rounded-lg w-full max-w-md relative">
      <button
        class="absolute top-3 right-3 text-primary-base hover:text-primary-dark"
        onclick="closeAddUserModal()"
        type="button"
        aria-label="Close"
      >
        âœ•
      </button>

      <div class="space-y-1 mb-6">
        <h1 class="text-lg font-semibold">Add New User</h1>
        <p class="text-sm text-primary-base">
          Fill in the details to create a new user account.
        </p>
      </div>

      <form
        method="post"
        th:action="@{/user/add}"
        id="add-user-form"
        onsubmit="return validateAddUserForm()"
      >
        <input
          type="hidden"
          th:name="${_csrf.parameterName}"
          th:value="${_csrf.token}"
        />

        <div class="mb-4 space-y-1">
          <label class="block text-sm font-medium">Name</label>
          <input
            type="text"
            name="name"
            id="add-user-name"
            placeholder="John Doe"
            class="w-full border border-primary-base rounded-md px-3 py-2 text-sm focus:outline-none focus:border-primary-dark focus:ring-1 focus:ring-primary-dark"
          />
          <div
            id="add-user-name-error"
            class="hidden text-xs text-red-text mt-1"
          ></div>
        </div>

        <div class="mb-4 space-y-1">
          <label class="block text-sm font-medium">Email</label>
          <input
            type="email"
            name="email"
            id="add-user-email"
            placeholder="admin@example.com"
            class="w-full border border-primary-base rounded-md px-3 py-2 text-sm focus:outline-none focus:border-primary-dark focus:ring-1 focus:ring-primary-dark"
          />
          <div
            id="add-user-email-error"
            class="hidden text-xs text-red-text mt-1"
          ></div>
        </div>

        <div class="mb-4 space-y-1">
          <div
            th:replace="fragments/custom-select :: customSelect('user-role', 'role', 'Role', ${roleOptions}, null)"
          ></div>
        </div>

        <div class="mb-8 space-y-1">
          <label class="block text-sm font-medium">Password</label>
          <input
            type="password"
            name="password"
            id="add-user-password"
            placeholder="password"
            class="w-full border border-primary-base rounded-md px-3 py-2 text-sm focus:outline-none focus:border-primary-dark focus:ring-1 focus:ring-primary-dark"
          />
          <div
            id="add-user-password-error"
            class="hidden text-xs text-red-text mt-1"
          ></div>
        </div>

        <div class="flex justify-end gap-3">
          <button
            type="button"
            onclick="closeAddUserModal()"
            class="w-28 px-4 py-2 rounded font-medium bg-red-bg text-red-text border border-red-border transition-colors duration-150 hover:bg-red-bg-hover hover:text-red-text-hover hover:border-red-border-hover"
          >
            Cancel
          </button>

          <button
            type="submit"
            class="w-28 px-4 py-2 rounded font-medium bg-primary-base text-white border border-primary-dark transition-colors duration-150 hover:bg-primary-dark hover:border-primary-dark"
          >
            Add User
          </button>
        </div>
      </form>
    </div>

    <script>
      function validateAddUserForm() {
        let valid = true;
        // Name
        const name = document.getElementById("add-user-name").value.trim();
        const nameError = document.getElementById("add-user-name-error");
        if (!name) {
          nameError.textContent = "Name is required.";
          nameError.classList.remove("hidden");
          valid = false;
        } else {
          nameError.classList.add("hidden");
        }
        // Email
        const email = document.getElementById("add-user-email").value.trim();
        const emailError = document.getElementById("add-user-email-error");
        if (!email) {
          emailError.textContent = "Email is required.";
          emailError.classList.remove("hidden");
          valid = false;
        } else if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
          emailError.textContent = "Enter a valid email address.";
          emailError.classList.remove("hidden");
          valid = false;
        } else {
          emailError.classList.add("hidden");
        }
        // Password
        const password = document
          .getElementById("add-user-password")
          .value.trim();
        const passwordError = document.getElementById(
          "add-user-password-error"
        );
        if (!password) {
          passwordError.textContent = "Password is required.";
          passwordError.classList.remove("hidden");
          valid = false;
        } else {
          passwordError.classList.add("hidden");
        }
        return valid;
      }

      function openAddUserModal() {
        const modal = document.getElementById("add-user-modal");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      }

      function closeAddUserModal() {
        const modal = document.getElementById("add-user-modal");
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }
    </script>
  </div>
</html>
